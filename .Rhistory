# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "RdYlBu", palette = "Greens",
group = "EVI scV")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Greens",
group = "EVI scV")
pal20 <- c("#003200", "#3C9600", "#006E00", "#556E19", "#00C800", "#8CBE8C",
"#467864", "#B4E664", "#9BC832", "#EBFF64", "#F06432", "#9132E6",
"#E664E6", "#9B82E6", "#B4FEF0", "#646464", "#C8C8C8", "#FF0000",
"#FFFFFF", "#5ADCDC")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = pal20, max.categories = 20,
group = "EVI scV")
?colorRampPalette
colorRampPalette(c("red","gree","blue"), bias = 2)
colorRampPalette(c("red","green","blue"), bias = 2)
porfavor <- colorRampPalette(c("red","green","blue"), bias = 2)
porfavor()
porfavor <- colorRampPalette(c("red","green","blue"), bias = 2, method = "linear")
porfavor <- colorRampPalette(c("red","green","blue"), bias = 2)
porfavor(10)
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = porfavor(10),
group = "EVI scV")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = porfavor(30),
group = "EVI scV")
porfavor <- colorRampPalette(c("red","green","blue"), bias = 4)
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = porfavor(30),
group = "EVI scV")
micoloritos <- brewer.pal(9, "BuPu")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = miscoloritos,
group = "EVI scV")
micoloritos <- brewer.pal(9, "BuPu")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = miscoloritos,
group = "EVI scV")
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
group = "EVI scV")
rgb(215,25,28,0)
?rgb
rgb(r=215,g=25,g=28,maxColorValue = 0)
rgb(r=215,g=25,b=28,maxColorValue = 0)
rgb(r=215,g=25,b=28,maxColorValue = 255)
evi_mmax_levels
mmax_palette <- data.frame(color = c(
rgb(r=0,g=0,b=255,maxColorValue = 255),
rgb(r=0,g=206,b=255,maxColorValue = 255),
rgb(r=0,g=179,b=128,maxColorValue = 255),
rgb(r=0,g=199,b=0,maxColorValue = 255),
rgb(r=165,g=255,b=0,maxColorValue = 255),
rgb(r=255,g=194,b=0,maxColorValue = 255),
rgb(r=255,g=123,b=0,maxColorValue = 255),
rgb(r=186,g=0,b=0,maxColorValue = 255),
rgb(r=145,g=77,b=33,maxColorValue = 255),
rgb(r=167,g=58,b=109,maxColorValue = 255),
rgb(r=152,g=32,b=240,maxColorValue = 255),
rgb(r=84,g=41,b=165,maxColorValue = 255)),
level = 1:12
)
mmax_palette
write_csv(mmax_palette, here::here("data/paleta_mmax.csv"))
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax"))
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
# tm_shape(eftFactor, name = "EFT") +
# tm_raster(palette = eft_palette$eft_color,
#           alpha = 0.5, legend.is.portrait = FALSE) +
# tmap_options(max.categories = 64) +
# tm_shape(pixel) + tm_polygons(labels = NULL,
#                               popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
#                                              "Seasonality (EVI scV)" = "EVI_sCV",
#                                              "Phenology (Month max EVI)" = "EVI_monthMax"),
#                               alpha=.01, border.col = NA, border.alpha = 0.001,
#                               group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
group = "EVI scV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE)
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE) +
tmap_options(max.categories = 64) +
tm_shape(pixel) + tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
group = "EVI scV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE) +
tm_shape(rareza, name ="EFT rarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Blues", n = 10,
group = "EFT rarity") +
tm_shape(eft_var, name = "EFT interannual variability") +
tm_raster(alpha = 0.5, legend.is.portrait = FALSE, colorNA = NULL,
group = "EFT interannual variability",
palette = "BuPu", n =16) +
tm_shape(disimilitud, name = "Dissimilarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Reds", n = 10, contrast = c(0, 1),
group = "Dissimilarity") +
tm_shape(divesp, name = "DivEsp") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL, style = "pretty",
palette = "Purples", n = 12,
group = "DivEsp")
mapita <- mapita %>%
tmap_leaflet() %>%
leaflet::hideGroup("EVI mean") %>%
leaflet::hideGroup("EVI sCV") %>%
leaflet::hideGroup("EVI mMax") %>%
leaflet::hideGroup("EFT rarity") %>%
leaflet::hideGroup("EFT interannual variability") %>%
leaflet::hideGroup("DivEsp") %>%
leaflet::hideGroup("Dissimilarity")
mapita
mapita
# Chunk 1: setup
library("flexdashboard")
library("tidyverse")
library("here")
library("raster")
library("rasterVis")
library("tmap")
library("mapview")
library("lubridate")
library("leaflet")
library("RColorBrewer")
# Chunk 2
# Read raster
# evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016.tif"))
evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016_v2.tif"))
evi_mmax<- raster(here::here("data/EVI_MMAX_230m_2001-2016.tif"))
evi_cv <- raster(here::here("data/EVI_sCV_230m_2001-2016.tif"))
eft <- raster(here::here("/data/EFTs_230m_2001-2016.tif"))
rareza <- raster(here::here("data/Rareza_230m_2001-2016.tif"))
NAvalue(rareza) <- 0
eft_var <- raster(here::here("data/Variabilidad_interanual_230m_2001-2016.tif"))
disimilitud <- raster(here::here("data/Disimilud_EFTs_1840m_2001-2016.tif"))
NAvalue(disimilitud) <- 1
divesp <- raster(here::here("data/DivEspaMediaEFTs_1840m_2001-2016_.tif"))
NAvalue(divesp) <- 0
# Solve small variations of extent
evi_mmax <- projectRaster(evi_mmax, evi_mean)
evi_cv <- projectRaster(evi_cv, evi_mean)
eft <- projectRaster(eft, evi_mean)
# Units
evi_mean <-evi_mean / 10000
evi_cv <- evi_cv / 100
eft <- round(eft)
evi_mmax <- round(evi_mmax)
# Add months to evi_mmax
evi_mmax_levels <- data.frame(level = 1:12,
month = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
evi_mmax <- ratify(evi_mmax)
mmax_rat <-levels(evi_mmax)[[1]]
mmax_rat <- mmax_rat %>% left_join(evi_mmax_levels, by = c("ID"="level"))
levels(evi_mmax) <- mmax_rat
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
# eft attributes
# https://rdrr.io/cran/raster/man/factor.html
eft_palette <- read_csv(here::here("data/paleta_eft.csv"))
# Asign eft attributes
# see an example from https://annakrystalli.me/intro-r-gis/raster.html
eft_levels <- eft_palette %>% dplyr::select(eft_id, eft_code, eft_color) %>% as.data.frame()
eft <- ratify(eft)
eft_rat <- levels(eft)[[1]]
eft_rat <- eft_rat %>% left_join(eft_levels, by=c("ID" = "eft_id"))
levels(eft) <- eft_rat
eftFactor <- deratify(eft, "eft_code")
# Rename layers
names(evi_mean) <- "EVI_Mean"
names(evi_mmax) <- "EVI_DateMax"
names(evi_cv) <- "EVI_sCV"
names(eft) <- "EFT"
names(eftFactor) <- "EFT"
names(rareza) <- "EFT rarity"
names(eft_var) <- "EFT var"
# Create stack
evi_stack <- stack(eft, evi_mean, evi_mmax, evi_cv, RAT = TRUE)
pixel <- rasterToPolygons(evi_stack)
pixel <- merge(pixel, eft_palette[,c("eft_code", "eft_id")], by.x = "EFT", by.y = "eft_id")
pixel@data <- pixel@data[,-1]
names(pixel)[4] <- "EFT"
pixel <- pixel[,c(4,1:3)]
pixel$EVI_DateMaxMonth<- as.character(month(ymd(010101) + months(pixel$EVI_DateMax-1), label=TRUE, abbr = TRUE))
pixel@data <- pixel@data[,-3]
names(pixel)[4] <- "EVI_monthMax"
# Remove 0 from etfvar
eft_var[eft_var < 1] <- NA
# Chunk 3
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE) +
tmap_options(max.categories = 64) +
tm_shape(pixel) + tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
group = "EVI scV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE) +
tm_shape(rareza, name ="EFT rarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Blues", n = 10,
group = "EFT rarity") +
tm_shape(eft_var, name = "EFT interannual variability") +
tm_raster(alpha = 0.5, legend.is.portrait = FALSE, colorNA = NULL,
group = "EFT interannual variability",
palette = "BuPu", n =16) +
tm_shape(disimilitud, name = "Dissimilarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Reds", n = 10, contrast = c(0, 1),
group = "Dissimilarity") +
tm_shape(divesp, name = "DivEsp") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL, style = "pretty",
palette = "Purples", n = 12,
group = "DivEsp")
mapita <- mapita %>%
tmap_leaflet() %>%
leaflet::hideGroup("EVI mean") %>%
leaflet::hideGroup("EVI sCV") %>%
leaflet::hideGroup("EVI mMax") %>%
leaflet::hideGroup("EFT rarity") %>%
leaflet::hideGroup("EFT interannual variability") %>%
leaflet::hideGroup("DivEsp") %>%
leaflet::hideGroup("Dissimilarity")
mapita
library("flexdashboard")
library("tidyverse")
library("here")
library("raster")
library("rasterVis")
library("tmap")
library("mapview")
library("lubridate")
library("leaflet")
library("RColorBrewer")
# Read raster
# evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016.tif"))
evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016_v2.tif"))
evi_mmax<- raster(here::here("data/EVI_MMAX_230m_2001-2016.tif"))
evi_cv <- raster(here::here("data/EVI_sCV_230m_2001-2016.tif"))
eft <- raster(here::here("/data/EFTs_230m_2001-2016.tif"))
rareza <- raster(here::here("data/Rareza_230m_2001-2016.tif"))
NAvalue(rareza) <- 0
eft_var <- raster(here::here("data/Variabilidad_interanual_230m_2001-2016.tif"))
disimilitud <- raster(here::here("data/Disimilud_EFTs_1840m_2001-2016.tif"))
NAvalue(disimilitud) <- 1
divesp <- raster(here::here("data/DivEspaMediaEFTs_1840m_2001-2016_.tif"))
NAvalue(divesp) <- 0
# Solve small variations of extent
evi_mmax <- projectRaster(evi_mmax, evi_mean)
evi_cv <- projectRaster(evi_cv, evi_mean)
eft <- projectRaster(eft, evi_mean)
# Units
evi_mean <-evi_mean / 10000
evi_cv <- evi_cv / 100
eft <- round(eft)
evi_mmax <- round(evi_mmax)
# Add months to evi_mmax
evi_mmax_levels <- data.frame(level = 1:12,
month = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
evi_mmax <- ratify(evi_mmax)
mmax_rat <-levels(evi_mmax)[[1]]
mmax_rat <- mmax_rat %>% left_join(evi_mmax_levels, by = c("ID"="level"))
levels(evi_mmax) <- mmax_rat
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
# eft attributes
# https://rdrr.io/cran/raster/man/factor.html
eft_palette <- read_csv(here::here("data/paleta_eft.csv"))
# Asign eft attributes
# see an example from https://annakrystalli.me/intro-r-gis/raster.html
eft_levels <- eft_palette %>% dplyr::select(eft_id, eft_code, eft_color) %>% as.data.frame()
eft <- ratify(eft)
eft_rat <- levels(eft)[[1]]
eft_rat <- eft_rat %>% left_join(eft_levels, by=c("ID" = "eft_id"))
levels(eft) <- eft_rat
eftFactor <- deratify(eft, "eft_code")
# Rename layers
names(evi_mean) <- "EVI_Mean"
names(evi_mmax) <- "EVI_DateMax"
names(evi_cv) <- "EVI_sCV"
names(eft) <- "EFT"
names(eftFactor) <- "EFT"
names(rareza) <- "EFT rarity"
names(eft_var) <- "EFT var"
# Create stack
evi_stack <- stack(eft, evi_mean, evi_mmax, evi_cv, RAT = TRUE)
pixel <- rasterToPolygons(evi_stack)
pixel <- merge(pixel, eft_palette[,c("eft_code", "eft_id")], by.x = "EFT", by.y = "eft_id")
pixel@data <- pixel@data[,-1]
names(pixel)[4] <- "EFT"
pixel <- pixel[,c(4,1:3)]
pixel$EVI_DateMaxMonth<- as.character(month(ymd(010101) + months(pixel$EVI_DateMax-1), label=TRUE, abbr = TRUE))
pixel@data <- pixel@data[,-3]
names(pixel)[4] <- "EVI_monthMax"
# Remove 0 from etfvar
eft_var[eft_var < 1] <- NA
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE) +
tmap_options(max.categories = 64) +
tm_shape(pixel) + tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EVI values") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "-RdBu", midpoint = .1853,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
group = "EVI sCV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE,
group = "EVI mMax") +
tm_shape(rareza, name ="EFT rarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Blues", n = 10,
group = "EFT rarity") +
tm_shape(eft_var, name = "EFT interannual variability") +
tm_raster(alpha = 0.5, legend.is.portrait = FALSE, colorNA = NULL,
group = "EFT interannual variability",
palette = "BuPu", n =16) +
tm_shape(disimilitud, name = "Dissimilarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "Reds", n = 10, contrast = c(0, 1),
group = "Dissimilarity") +
tm_shape(divesp, name = "DivEsp") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL, style = "pretty",
palette = "Purples", n = 12,
group = "DivEsp")
mapita <- mapita %>%
tmap_leaflet() %>%
leaflet::hideGroup("EVI mean") %>%
leaflet::hideGroup("EVI sCV") %>%
leaflet::hideGroup("EVI mMax") %>%
leaflet::hideGroup("EFT rarity") %>%
leaflet::hideGroup("EFT interannual variability") %>%
leaflet::hideGroup("DivEsp") %>%
leaflet::hideGroup("Dissimilarity")
mapita
