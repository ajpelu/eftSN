pixel$EVI_DateMaxMonth <- as.character(
1 = "Jan", 2 = "Feb", 3 = "Mar", 4 = "Apr", 5 = "May", 6 = "Jun",
7 = "Jul", 8 = "Aug", 9 = "Sep", 10 = "Oct", 11 = "Nov", 12 ="Dec")
pixel$EVI_DateMaxMonth <- as.character(
c(1 = "Jan", 2 = "Feb", 3 = "Mar", 4 = "Apr", 5 = "May", 6 = "Jun",
7 = "Jul", 8 = "Aug", 9 = "Sep", 10 = "Oct", 11 = "Nov", 12 ="Dec"))
pixel <- pixel[,c(4,1:3)]
pixel$EVI_DateMaxMonth <- as.character(c(1 = "Jan", 2 = "Feb", 3 = "Mar", 4 = "Apr", 5 = "May", 6 = "Jun", 7 = "Jul", 8 = "Aug", 9 = "Sep", 10 = "Oct", 11 = "Nov", 12 ="Dec"))
pixel$EVI_DateMaxMonth <- as.character(c("Jan" = 1, 2 = "Feb", 3 = "Mar", 4 = "Apr", 5 = "May", 6 = "Jun", 7 = "Jul", 8 = "Aug", 9 = "Sep", 10 = "Oct", 11 = "Nov", 12 ="Dec"))
pixel$EVI_DateMaxMonth <- cut(pixel$pixel$EVI_DateMax,
breaks(1:12),
labels(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")))
pixel$EVI_DateMaxMonth <- cut(pixel$EVI_DateMax,
breaks(1:12),
labels(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")))
pixel$EVI_DateMaxMonth <- cut(pixel$EVI_DateMax,
breaks = c(1:12),
labels(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")))
pixel$EVI_DateMaxMonth <- cut(pixel$EVI_DateMax,
breaks = c(2:12),
labels(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")))
pixel$EVI_DateMaxMonth <- as.character(month(ymd(010101) + months(pixel$EVI_DateMax-1), label=TRUE))
unique(pixel$EVI_DateMaxMonth)
pixel$EVI_DateMaxMonth <-
pixel$EVI_DateMaxMonth <- month.abb(as.character(month(ymd(010101) + months(pixel$EVI_DateMax-1)) label=TRUE))
pixel$EVI_DateMaxMonth <-
pixel$EVI_DateMaxMonth <- month.abb(month(ymd(010101) + months(pixel$EVI_DateMax-1)) label=TRUE)
pixel$EVI_DateMaxMonth <-
pixel$EVI_DateMaxMonth <- month.abb(month(ymd(010101) + months(pixel$EVI_DateMax-1)), label=TRUE)
?month.abb
pixel$EVI_DateMaxMonth <-
pixel$EVI_DateMaxMonth <- month.abb(month(ymd(010101) + months(pixel$EVI_DateMax-1)), label=TRUE)
pixel$EVI_DateMaxMonth <-
pixel$EVI_DateMaxMonth <- base::month.abb(month(ymd(010101) + months(pixel$EVI_DateMax-1)), label=TRUE)
pixel$EVI_DateMaxMonth <- as.character(
month(ymd(010101) + months(pixel$EVI_DateMax-1), label=TRUE, abbr = TRUE))
head(pixel)
pixel$EVI_DateMaxMonth <- match(pixel$EVI_DateMax, month.abb)
unique(pixel$EVI_DateMaxMonth)
head(pixel)
pixel$EVI_DateMaxMonth <- month.abb[pixel$EVI_DateMax]
head(pixel)
unique(pixel@data)
unique(pixel@data$EVI_DateMaxMonth)
# Read raster
# evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016.tif"))
evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016_v2.tif"))
evi_mmax<- raster(here::here("data/EVI_MMAX_230m_2001-2016.tif"))
evi_cv <- raster(here::here("data/EVI_sCV_230m_2001-2016.tif"))
# evi_cvp <-  raster(here::here("data/EVI_sCV_230m_2001-2016_pangea.tif"))
eft <- raster(here::here("/data/EFTs_230m_2001-2016.tif"))
rareza <- raster(here::here("data/Rareza_230m_2001-2016.tif"))
NAvalue(rareza) <- 0
eft_var <- raster(here::here("data/Variabilidad_interanual_230m_2001-2016.tif"))
disimilitud <- raster(here::here("data/Disimilud_EFTs_1840m_2001-2016.tif"))
NAvalue(disimilitud) <- 1
divesp <- raster(here::here("data/DivEspaMediaEFTs_1840m_2001-2016_.tif"))
NAvalue(divesp) <- 0
# Solve small variations of extent
evi_mmax <- projectRaster(evi_mmax, evi_mean)
evi_cv <- projectRaster(evi_cv, evi_mean)
eft <- projectRaster(eft, evi_mean)
# Units
evi_mean <-evi_mean / 10000
evi_cv <- round(evi_cv, 4)
eft <- round(eft)
evi_mmax <- round(evi_mmax)
# Add months to evi_mmax
evi_mmax_levels <- data.frame(level = 1:12,
month = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
evi_mmax <- ratify(evi_mmax)
mmax_rat <-levels(evi_mmax)[[1]]
mmax_rat <- mmax_rat %>% left_join(evi_mmax_levels, by = c("ID"="level"))
levels(evi_mmax) <- mmax_rat
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
# eft attributes
# https://rdrr.io/cran/raster/man/factor.html
eft_palette <- read_csv(here::here("data/paleta_eft.csv"))
# Asign eft attributes
# see an example from https://annakrystalli.me/intro-r-gis/raster.html
eft_levels <- eft_palette %>% dplyr::select(eft_id, eft_code, eft_color) %>% as.data.frame()
eft <- ratify(eft)
eft_rat <- levels(eft)[[1]]
eft_rat <- eft_rat %>% left_join(eft_levels, by=c("ID" = "eft_id"))
levels(eft) <- eft_rat
eftFactor <- deratify(eft, "eft_code")
# Rename layers
names(evi_mean) <- "EVI_Mean"
names(evi_mmax) <- "EVI_DateMax"
names(evi_cv) <- "EVI_sCV"
names(eft) <- "EFT"
names(eftFactor) <- "EFT"
names(rareza) <- "EFT rarity"
names(eft_var) <- "EFT var"
# Create stack
evi_stack <- stack(eft, evi_mean, evi_mmax, evi_cv, RAT = TRUE)
pixel <- rasterToPolygons(evi_stack)
pixel <- merge(pixel, eft_palette[,c("eft_code", "eft_id")], by.x = "EFT", by.y = "eft_id")
pixel@data <- pixel@data[,-1]
names(pixel)[4] <- "EFT"
pixel <- pixel[,c(4,1:3)]
pixel$EVI_DateMaxMonth <- month.abb[pixel$EVI_DateMax]
pixel@data <- pixel@data[,-3]
names(pixel)[4] <- "EVI_monthMax"
# Remove 0 from etfvar
eft_var[eft_var < 1] <- NA
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = "seq", style = "cont", stretch.palette = TRUE,
# rainbow(20, rev = TRUE)
group = "EVI mean")
mapita
aes.color
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(20, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EVI mean")
mapita
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(10, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EVI mean")
mapita
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EVI mean")
mapita
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.5, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
breaks = c(seq(from=0, to = 0.01, by=0.001), Inf),
group = "EVI sCV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE,
group = "EVI mMax") +
tm_shape(rareza, name ="EFT rarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EFT rarity") +
tm_shape(eft_var, name = "EFT interannual variability") +
tm_raster(alpha = 0.5, legend.is.portrait = FALSE, colorNA = NULL,
group = "EFT inter-annual variability",
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE) +
tm_shape(disimilitud, name = "Dissimilarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8), style = "cont", stretch.palette = TRUE,
group = "Dissimilarity") +
tm_shape(divesp, name = "EFT richness") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL, style = "pretty",
palette = rainbow(8), style = "cont", stretch.palette = TRUE,
group = "EFT richnes")
mapita <- mapita %>%
tmap_leaflet() %>%
leaflet::hideGroup("EVI mean") %>%
leaflet::hideGroup("EVI sCV") %>%
leaflet::hideGroup("EVI mMax") %>%
leaflet::hideGroup("EFT rarity") %>%
leaflet::hideGroup("EFT interannual variability") %>%
leaflet::hideGroup("EFT richnes") %>%
leaflet::hideGroup("Dissimilarity")
mapita
tm_layout()
?rainbow
tmap_mode("view")
mapita <- tm_basemap(c("Esri.WorldGrayCanvas", "Esri.WorldTopoMap")) +
tm_shape(eftFactor, name = "EFT") +
tm_raster(palette = eft_palette$eft_color,
alpha = 0.8, legend.is.portrait = FALSE, group = "EFT") +
tmap_options(max.categories = 64) +
tm_shape(pixel) +
tm_polygons(labels = NULL,
popup.vars = c("Productivity (EVI mean)" = "EVI_Mean",
"Seasonality (EVI scV)" = "EVI_sCV",
"Phenology (Month max EVI)" = "EVI_monthMax"),
alpha=.01, border.col = NA, border.alpha = 0.001,
group = "EFT") +
tm_shape(evi_mean, name = "EVI mean") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(10, rev = TRUE, type="sequential"), style = "cont", stretch.palette = TRUE,
group = "EVI mean") +
tm_shape(evi_cv, name = "EVI scV)") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
# breaks = c(seq(from=0, to = 0.01, by=0.001), Inf),
group = "EVI sCV") +
tm_shape(evi_mmax, name = "EVI mMax") +
tm_raster(palette = evi_mmax_palette$color, legend.is.portrait = FALSE,
group = "EVI mMax") +
tm_shape(rareza, name ="EFT rarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE,
group = "EFT rarity") +
tm_shape(eft_var, name = "EFT interannual variability") +
tm_raster(alpha = 0.5, legend.is.portrait = FALSE, colorNA = NULL,
group = "EFT inter-annual variability",
palette = rainbow(8, rev = TRUE), style = "cont", stretch.palette = TRUE) +
tm_shape(disimilitud, name = "Dissimilarity") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8), style = "cont", stretch.palette = TRUE,
group = "Dissimilarity") +
tm_shape(divesp, name = "EFT richness") +
tm_raster(legend.is.portrait = FALSE, colorNA = NULL,
palette = rainbow(8), style = "cont", stretch.palette = TRUE,
group = "EFT richnes")
mapita <- mapita %>%
tmap_leaflet() %>%
leaflet::hideGroup("EVI mean") %>%
leaflet::hideGroup("EVI sCV") %>%
leaflet::hideGroup("EVI mMax") %>%
leaflet::hideGroup("EFT rarity") %>%
leaflet::hideGroup("EFT interannual variability") %>%
leaflet::hideGroup("EFT richnes") %>%
leaflet::hideGroup("Dissimilarity")
mapita
evi_cv2 <- evi_cv[evi_cv < 100]
plot(evi_cv2)
plot(evi_cv[evi_cv < 100])
str(evi_cv)
plot(evi_cv)
plot(evi_cv[evi_cv < 100])
ee <- [evi_cv] < 100
hist(evi_cv)
hist(evi_cv[evi_cv < 100])
hist(evi_cv[evi_cv < 10])
hist(evi_cv[evi_cv < 8])
hist(evi_cv[evi_cv < 6])
quantile(evi_cv)
quantile(evi_cv, 90)
evi_cv2 <- reclass(evi_cv, function(x){x[x>10] <- 10; return(x)})
evi_cv2 <- raster::calc(evi_cv, function(x){x[x>10] <- 10; return(x)})
plot(evi_cv2)
evi_cv2 <- raster::calc(evi_cv, function(x){x[x>2] <- 2; return(x)})
plot(evi_cv2)
library("flexdashboard")
library("tidyverse")
library("here")
library("raster")
library("rasterVis")
library("tmap")
library("mapview")
library("lubridate")
library("leaflet")
library("RColorBrewer")
```{r setup, include=FALSE}
library("flexdashboard")
library("tidyverse")
library("here")
library("raster")
library("rasterVis")
library("tmap")
library("mapview")
library("lubridate")
library("leaflet")
library("RColorBrewer")
```
```{r}
# Read raster
# evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016.tif"))
evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016_v2.tif"))
evi_mmax<- raster(here::here("data/EVI_MMAX_230m_2001-2016.tif"))
evi_cv <- raster(here::here("data/EVI_sCV_230m_2001-2016.tif"))
# evi_cvp <-  raster(here::here("data/EVI_sCV_230m_2001-2016_pangea.tif"))
eft <- raster(here::here("/data/EFTs_230m_2001-2016.tif"))
rareza <- raster(here::here("data/Rareza_230m_2001-2016.tif"))
NAvalue(rareza) <- 0
eft_var <- raster(here::here("data/Variabilidad_interanual_230m_2001-2016.tif"))
disimilitud <- raster(here::here("data/Disimilud_EFTs_1840m_2001-2016.tif"))
NAvalue(disimilitud) <- 1
divesp <- raster(here::here("data/DivEspaMediaEFTs_1840m_2001-2016_.tif"))
NAvalue(divesp) <- 0
# Solve small variations of extent
evi_mmax <- projectRaster(evi_mmax, evi_mean)
evi_cv <- projectRaster(evi_cv, evi_mean)
eft <- projectRaster(eft, evi_mean)
# Units
evi_mean <-evi_mean / 10000
evi_cv <- round(evi_cv, 4)
eft <- round(eft)
evi_mmax <- round(evi_mmax)
# Add months to evi_mmax
evi_mmax_levels <- data.frame(level = 1:12,
month = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
evi_mmax <- ratify(evi_mmax)
mmax_rat <-levels(evi_mmax)[[1]]
mmax_rat <- mmax_rat %>% left_join(evi_mmax_levels, by = c("ID"="level"))
levels(evi_mmax) <- mmax_rat
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
# eft attributes
# https://rdrr.io/cran/raster/man/factor.html
eft_palette <- read_csv(here::here("data/paleta_eft.csv"))
# Asign eft attributes
# see an example from https://annakrystalli.me/intro-r-gis/raster.html
eft_levels <- eft_palette %>% dplyr::select(eft_id, eft_code, eft_color) %>% as.data.frame()
eft <- ratify(eft)
eft_rat <- levels(eft)[[1]]
eft_rat <- eft_rat %>% left_join(eft_levels, by=c("ID" = "eft_id"))
levels(eft) <- eft_rat
eftFactor <- deratify(eft, "eft_code")
names(disimilitud)
names(divesp)
names(divesp) <- "EFT richness"
names(rareza)
names(rareza) <- "EFT rarity"
names(disimilitud)
names(disimilitud) <- "Dissimilarity"
?tm_raster
rainbow(20, rev = TRUE)
seq(from=0, to = 1, by=0.025)
?rainbow
hcl.pals("sequential")
Red-Blue
install.packages("pals")
pal.bands(kovesi.rainbow)
pals::kovesi.rainbow()
pals::kovesi.rainbow(10)
kovesi.rainbow(10)
require(pals)
pal.bands(coolwarm, parula, ocean.haline, brewer.blues, cubicl, kovesi.rainbow, ocean.phase, brewer.paired(12), stepped,
main="Colormap suggestions")
pal.bands(kovesi.rainbow)
kovesi.rainbow()
kovesi.rainbow(10)
leaflet() %>%
addTiles() %>%
addRasterImage(rareza,
colors = kovesi.rainbow(20))
# tm_shape(rareza, name ="EFT rarity") +
# tm_raster(alpha=.7, legend.is.portrait = FALSE, colorNA = NULL,
#           palette = kovesi.rainbow(20), style = "cont",
#           group = "EFT rarity")
library(tidyverse)
leaflet() %>%
addTiles() %>%
addRasterImage(rareza,
colors = kovesi.rainbow(20))
library("flexdashboard")
library("tidyverse")
library("here")
library("raster")
library("rasterVis")
library("tmap")
library("mapview")
library("lubridate")
library("leaflet")
library("RColorBrewer")
leaflet() %>%
addTiles() %>%
addRasterImage(rareza,
colors = kovesi.rainbow(20))
leaflet() %>%
addTiles() %>%
addRasterImage(rareza)
plot(rareza)
# Read raster
# evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016.tif"))
evi_mean <- raster(here::here("data/EVI_medio_230m_2001-2016_v2.tif"))
evi_mmax<- raster(here::here("data/EVI_MMAX_230m_2001-2016.tif"))
evi_cv <- raster(here::here("data/EVI_sCV_230m_2001-2016.tif"))
# evi_cvp <-  raster(here::here("data/EVI_sCV_230m_2001-2016_pangea.tif"))
eft <- raster(here::here("/data/EFTs_230m_2001-2016.tif"))
rareza <- raster(here::here("data/Rareza_230m_2001-2016.tif"))
NAvalue(rareza) <- 0
eft_var <- raster(here::here("data/Variabilidad_interanual_230m_2001-2016.tif"))
disimilitud <- raster(here::here("data/Disimilud_EFTs_1840m_2001-2016.tif"))
NAvalue(disimilitud) <- 1
divesp <- raster(here::here("data/DivEspaMediaEFTs_1840m_2001-2016_.tif"))
NAvalue(divesp) <- 0
# Solve small variations of extent
evi_mmax <- projectRaster(evi_mmax, evi_mean)
evi_cv <- projectRaster(evi_cv, evi_mean)
eft <- projectRaster(eft, evi_mean)
# Units
evi_mean <-evi_mean / 10000
evi_cv <- round(evi_cv, 4)
eft <- round(eft)
evi_mmax <- round(evi_mmax)
# Add months to evi_mmax
evi_mmax_levels <- data.frame(level = 1:12,
month = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
evi_mmax <- ratify(evi_mmax)
mmax_rat <-levels(evi_mmax)[[1]]
mmax_rat <- mmax_rat %>% left_join(evi_mmax_levels, by = c("ID"="level"))
levels(evi_mmax) <- mmax_rat
evi_mmax_palette <- read_csv(here::here("data/paleta_mmax.csv"))
# eft attributes
# https://rdrr.io/cran/raster/man/factor.html
eft_palette <- read_csv(here::here("data/paleta_eft.csv"))
# Asign eft attributes
# see an example from https://annakrystalli.me/intro-r-gis/raster.html
eft_levels <- eft_palette %>% dplyr::select(eft_id, eft_code, eft_color) %>% as.data.frame()
eft <- ratify(eft)
eft_rat <- levels(eft)[[1]]
eft_rat <- eft_rat %>% left_join(eft_levels, by=c("ID" = "eft_id"))
levels(eft) <- eft_rat
eftFactor <- deratify(eft, "eft_code")
# Rename layers
names(evi_mean) <- "EVI_Mean"
names(evi_mmax) <- "EVI_DateMax"
names(evi_cv) <- "EVI_sCV"
names(eft) <- "EFT"
names(eftFactor) <- "EFT"
names(rareza) <- "EFT rarity"
names(eft_var) <- "EFT var"
names(divesp) <- "EFT richness"
names(disimilitud) <- "Dissimilarity"
# Create stack
evi_stack <- stack(eft, evi_mean, evi_mmax, evi_cv, RAT = TRUE)
pixel <- rasterToPolygons(evi_stack)
pixel <- merge(pixel, eft_palette[,c("eft_code", "eft_id")], by.x = "EFT", by.y = "eft_id")
pixel@data <- pixel@data[,-1]
names(pixel)[4] <- "EFT"
pixel <- pixel[,c(4,1:3)]
pixel$EVI_DateMaxMonth <- month.abb[pixel$EVI_DateMax]
pixel@data <- pixel@data[,-3]
names(pixel)[4] <- "EVI_monthMax"
# Remove 0 from etfvar
eft_var[eft_var < 1] <- NA
evi_cv2 <- raster::calc(evi_cv, function(x){x[x>2] <- 2; return(x)})
names(evi_cv2) <- "EVI_sCV"
library(tidyverse)
leaflet() %>%
addTiles() %>%
addRasterImage(rareza)
leaflet() %>%
addTiles() %>%
addRasterImage(rareza, opacity = 0.4)
library("raster")
rarity <- raster("/Users/ajpelu/Downloads/EFT_rarity_230m_2001-2016.tif")
plot(rarity)
rarity
rarity@file@nbands
?writeRaster
writeRaster(rarity,"/Users/ajpelu/Downloads/EFT_rarity_230m_2001-2016RR.tif", options=c('TFW=YES'))
library("rgdal")
rarity <- raster("/Users/ajpelu/Downloads/EFT_rarity_230m_2001-2016.tif")
writeRaster(rarity,"/Users/ajpelu/Downloads/EFT_rarity_230m_2001-2016RR.tif", options=c('TFW=YES'))
library("pdftools")
install.packages("pdftools")
library("pdftools")
txt <- pdf_text("/Users/ajpelu/Desktop/imba47.pdf")
cat(txt)
txt[1]
toc <- pdf_toc("/Users/ajpelu/Desktop/imba47.pdf")
toc
